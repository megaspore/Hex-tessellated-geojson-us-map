{% load static %}
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Display a popup on hover</title>
        <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
        <link href="https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.css" rel="stylesheet">
        <script src="https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.js"></script>
        <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        </style>
    </head>
    <body>
        
        
        <style>
            .mapboxgl-popup {
                max-width: 400px;
                font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            }
        </style>
        

        <div>
           <div class='map' id='map' ></div> 
        </div>
      
        
        <script>
            
            mapboxgl.accessToken = 'pk.eyJ1IjoiYmVuZ2llaHVudCIsImEiOiJjbDloNWh2ZncwODVhM3VyeXU1bHdwOTVkIn0.ZmecDzfsknlIZEiUd0ZOiw';
            const map = new mapboxgl.Map({
                container: 'map',
                // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
                style: 'mapbox://styles/mapbox/streets-v11',
                center: [-94.04, 38.907],
                zoom: 3
            });
            
            
            map.on('load', () => {
                map.addSource('places', {
                    'type': 'geojson',
                    'data': "http://127.0.0.1:8000/weathermap/geofile"
                   
                
                });
                // Add a layer showing the places.
                map.addLayer({
                    'id': 'places',
                    'type': 'fill',
                    'source': 'places',
                    'paint': {
                        'fill-color': '#0080ff', // blue color fill
                        'fill-opacity': 0.5
                    }
                });
                map.addLayer({
                    'id': 'outline',
                    'type': 'line',
                    'source': 'places',
                    'layout': {},
                    'paint': {
                    'line-color': '#000',
                    'line-width': 3
                    }
                });

            

                //map.on('click', 'places', (e) => {
                //const popup = new mapboxgl.Popup()
                //.setLngLat(e.lngLat)
                //.setHTML(e.features[0].properties.name)
                //.addTo(map);
                //});

                // Create a popup, but don't add it to the map yet.
                const popup = new mapboxgl.Popup({
                    closeButton: false,
                    closeOnClick: false
                });

                

                    map.on('click', 'places', (e) => {
                    const popup = new mapboxgl.Popup();
                    // Change the cursor style as a UI indicator.
                    map.getCanvas().style.cursor = 'pointer';

                    // Copy coordinates array.
                    const coordinates = e.features[0].geometry.coordinates.slice();
                    const location = e.features[0].properties.location.split(",");
                    const maxtempfcast = parseFloat(e.features[0].properties.temp_max_forecast);
                    const mintempfcast = parseFloat(e.features[0].properties.temp_min_forecast);
                    const maxtempobsrv = parseFloat(e.features[0].properties.temp_max_observation);
                    const mintempobsrv = parseFloat(e.features[0].properties.temp_min_observation);
                    // Ensure that if the map is zoomed out such that multiple
                    // copies of the feature are visible, the popup appears
                    // over the copy being pointed to.
                    

                    // Populate the popup and set its coordinates
                    // based on the feature found.
                    popup.setLngLat(coordinates).setHTML(`${location[1]}, ${location[2]}, ${location[3]}
                                                        <br> Max Temp Forcast: ${maxtempfcast.toFixed(2)}
                                                        <br> Min Temp Forcast: ${mintempfcast.toFixed(2)}
                                                        <br> Max Temp Observed: ${maxtempobsrv.toFixed(2)}
                                                        <br> Min Temp Observed: ${mintempobsrv.toFixed(2)}`).addTo(map);
                });

                map.on('mouseleave', 'places', () => {
                    map.getCanvas().style.cursor = '';
                    popup.remove();
                });
            });
        </script>
       
    </body>
</html>